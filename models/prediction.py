"""Prediction Data Models.

Defines the structures for AI-generated predictions, simulations,
and risk assessments.
"""

from datetime import datetime
from enum import Enum
from typing import Any, Dict, List, Optional
from pydantic import BaseModel, Field, ConfigDict


class PredictionType(str, Enum):
    """Types of predictions generated by agents."""
    NEXT_LOCATION = "next_location"
    NEXT_VICTIM = "next_victim"
    SUSPECT_PROFILE = "suspect_profile"
    ESCALATION_RISK = "escalation_risk"
    NETWORK_DISCOVERY = "network_discovery"
    CRIME_TREND = "crime_trend"


class PredictionBase(BaseModel):
    """Base prediction model with shared fields."""
    type: PredictionType
    description: str
    confidence: float = Field(..., ge=0.0, le=1.0)
    generated_by: str  # Agent name
    parameters: Dict[str, Any] = {}
    
    model_config = ConfigDict(from_attributes=True)


class PredictionCreate(PredictionBase):
    """Model for creating a new prediction."""
    case_id: str
    target_id: Optional[str] = None  # Person or Location ID


class Prediction(PredictionBase):
    """Full prediction model including system-generated fields."""
    id: str
    case_id: str
    target_id: Optional[str] = None
    created_at: datetime = Field(default_factory=datetime.now)
    expires_at: Optional[datetime] = None


class EscalationPrediction(BaseModel):
    """Specific model for escalation risk predictions."""
    suspect_id: str
    risk_level: str  # low, medium, high
    probability: float
    factors: List[str]
    timeline: str  # Predicted window for escalation
